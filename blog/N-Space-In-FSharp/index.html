<!DOCTYPE HTML>
<!--
	Prologue 1.1 by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

	<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="icon" href="/favicon.ico">

	<title>N-Space in F#</title>
	
<!-- Google Analytics -->
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54925912-1', 'auto');
  ga('send', 'pageview');

	</script>
	
<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

	<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
	
<!-- Latest compiled and minified JavaScript -->
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
	
<!-- FontAwesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

<!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
	<script src="/assets/js/ie-emulation-modes-warning.js"></script>

	<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
 <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Custom styles for this template -->
	<link href="/carousel.css" rel="stylesheet">
	<link href="/post.css" rel="stylesheet">
	<link href="/syntax.css" rel="stylesheet">
  </head>

	<body>
		<!-- NAVBAR
================================================== -->
<body>
	<div class="navbar-wrapper">
		<div class="container">		
			<div class="navbar navbar-inverse navbar-static-top" role="navigation">
				<div class="container">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="/">
						<img class="img-grav" src="/assets/img/profile.jpg" alt="A picture of me.">  
						ProteinSim </a>
					</div>
					<div class="navbar-collapse collapse">
						<ul class="nav navbar-nav">
							
								<li><a href="/">Home</a></li>
								<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown"> Blog <span class="caret"></span></a>
								<ul class="dropdown-menu" role="menu">
									<li><a href="/blog/">Recent</a></li>
									<li class="divider"></li>
									<li><a href="/categories/">Categories</a></li>
								</ul>
								</li>
							
						</ul>
						<ul class="nav navbar-nav iconnav">
							<li class="icon-row"><a href="https://www.facebook.com/sshopkin" class="icon-link"><i class="fa fa-facebook-square social"></i></a></li>
							<li class="icon-row"><a href="https://www.linkedin.com/in/sawyerhopkins" class="icon-link"><i class="fa fa-linkedin-square social"></i></a></li>
							<li class="icon-row"><a href="https://github.com/SawyerHopkins" class="icon-link"><i class="fa fa-github-square social"></i></a></li>
							<li class="icon-row"><a href="mailto:sawyer@sawyerhopkins.com" class="icon-link"><i class="fa fa-envelope-square social"></i></a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
		    <!-- Carousel
    ================================================== -->
    <div id="myCarousel" class="carousel slide" data-ride="carousel">
      <div class="carousel-inner" role="listbox" style="background: url(/assets/img/sawyerheader.jpg) no-repeat top center fixed">
	  	
		<div class="item active">		
		

          <!--<img src="/assets/img/sawyerheader.png" class="img-responsive">-->
          <div class="container">
            <div class="carousel-caption">
              <h1><b><span class="carousel-text">N-Space in F#</span></b></h1>
              <p><span class="carousel-text">Creating N-Space grids for numerical evaluation of functions.</span></p>
            </div>
          </div>
        </div>		
		
	</div>	
    </div><!-- /.carousel -->
		
		<!-- Main -->
			<div id="main">
				<div class="container marketing">
			      <div class="post-block">

<p class="post-header">SciLib Core</p>
	
<p class="post-para"> To iterate over the possible pairings of two variables, you would likely use a nested for loop. For each additional variable you would increase the nesting depth by one. This creates a problem when iterating over an unknown number of variables, as you do not know the depth of loop nesting you will need. At the base of my main pet project, SciLib, is a small bit of F# code that works through this problem by creating a grid for an N-Dimensional space. Well actually that might be a bit misleading as you will see later on. Really I flatten the space into one dimension so that I can iterate over the space like I would a single variable. I realized while drafting this post that I mention the word function quite frequently. For this post I will try to use the word function to refer to some sort of mathematical function of N variables, and refer to functions and methods within the code ambiguously as a method.</p>
	
<!--more-->	
	
<p class="post-header">Getting Started</p>

<p class="post-para"> To begin setting up the space I start by passing two arguments to the initialize the class containing the evaluation method. The first being a class which defines the function, and the second being a set of boundary conditions for each variable of the function. When a user inputs a function, it is converted to an assembly using CodeDOM which is then contained in the <i>FunctionBaseCore</i> class. The <i>FunctionBounds</i> class is an array of boundary conditions which are formatted as three numbers: a lower bound, a upper bound, and a step size.</p>

<div class="post-para">
<div class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="lineno">1</span> <span class="k">type</span> <span class="nc">public</span> <span class="n">NFunctionalEqCore</span><span class="o">(_</span><span class="n">func</span> <span class="o">:</span> <span class="n">FunctionBaseCore</span><span class="o">,_</span><span class="n">bounds</span> <span class="o">:</span> <span class="n">FunctionBounds</span><span class="o">,</span> <span class="n">suppress</span><span class="o">)</span> <span class="o">=</span>
<span class="lineno">2</span>     <span class="sd">///The base function</span>
<span class="lineno">3</span>     <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nf">func</span> <span class="o">=</span> <span class="o">_</span><span class="n">func</span>
<span class="lineno">4</span>     <span class="sd">///The bounds to evaluate against</span>
<span class="lineno">5</span>     <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nf">bounds</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">ofSeq</span><span class="o">(_</span><span class="n">bounds</span><span class="o">.</span><span class="n">BoundsList</span><span class="o">)</span></code></pre></div>
</div>

<p class="post-para">I begin setting up the space by creating a discrete set of axes using the <i>List.map</i> method. The <i>map</i> method iterates over each set of boundary conditions and maps out the axis for the corresponding variable. Think of it as creating a set of number lines with a spacing of <i>bound.Step</i> between each tick mark. By putting two or more of these number lines together you get a grid. I then use to <i>fold</i> method to find the total number of data points on this grid that need to be evaluated.</p>

<div class="post-para">
<div class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="lineno">1</span> <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nf">evalFlat</span><span class="bp">()</span> <span class="o">=</span>
<span class="lineno">2</span>         <span class="k">if</span> <span class="o">(</span><span class="n">suppress</span> <span class="o">=</span> <span class="k">false</span><span class="o">)</span> <span class="k">then</span> <span class="nn">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="o">(</span><span class="s">&quot;Initializing Coordinate System&quot;</span><span class="o">)</span>
<span class="lineno">3</span>         <span class="c1">//Creates a list of lists containing each possible value of each variable at the given step size</span>
<span class="lineno">4</span>         <span class="k">let</span> <span class="nv">nbounds</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span><span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">bound</span> <span class="o">:</span> <span class="n">Bounds</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">[</span><span class="n">bound</span><span class="o">.</span><span class="n">Lower</span> <span class="o">..</span> <span class="n">bound</span><span class="o">.</span><span class="n">Step</span> <span class="o">..</span> <span class="n">bound</span><span class="o">.</span><span class="n">Upper</span><span class="o">])</span> <span class="n">this</span><span class="o">.</span><span class="n">bounds</span>
<span class="lineno">5</span>         <span class="c1">//Calculates the total number of unique points</span>
<span class="lineno">6</span>         <span class="k">let</span> <span class="nv">totalsize</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold</span><span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="n">f</span> <span class="o">-&gt;</span> <span class="n">acc</span><span class="o">*</span><span class="nn">List</span><span class="p">.</span><span class="n">length</span><span class="o">(</span><span class="n">f</span><span class="o">))</span> <span class="mi">1</span> <span class="n">nbounds</span></code></pre></div>
</div>

<p class="post-para"> So now that I have my N-Dimensional basis set up, and I know how many data points this basis corresponds to, I need to create a one dimensional array that contains every data point of the N-Space. I do this by creating the <i>cords</i> array with a length of <i>totalsize</i>. Now the trick is how to get an element of <i>cords</i> to contain all the information that identifies a unique point in the original N-Space. More specifically an element of cords should look like:</p>

<div class="post-para">
$$
[e_1,e_2,\ldots,e_n]
$$
</div>

<div class="post-para">
<div class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="lineno">1</span> <span class="k">let</span> <span class="nv">cords</span> <span class="o">=</span> <span class="k">new</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Collections</span><span class="p">.</span><span class="nn">Generic</span><span class="p">.</span><span class="n">List</span><span class="o">&lt;</span><span class="nn">System</span><span class="p">.</span><span class="nn">Collections</span><span class="p">.</span><span class="nn">Generic</span><span class="p">.</span><span class="n">List</span><span class="o">&lt;</span><span class="kt">float32</span><span class="o">&gt;&gt;</span><span class="bp">()</span>
<span class="lineno">2</span> <span class="k">for</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span> <span class="k">to</span> <span class="o">(</span><span class="n">totalsize</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="k">do</span>
<span class="lineno">3</span>     <span class="n">cords</span><span class="o">.</span><span class="n">Add</span><span class="o">(</span><span class="k">new</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Collections</span><span class="p">.</span><span class="nn">Generic</span><span class="p">.</span><span class="n">List</span><span class="o">&lt;</span><span class="kt">float32</span><span class="o">&gt;</span><span class="bp">()</span><span class="o">)</span></code></pre></div>
</div>

<p class="post-para">
I figure that the best way to describe what is happening in the code below is to include an example of what <i>cords</i> would look like for three variables that can have values 1 or 2. The table below shows the three variables as columns and each unique data point as a row. The main problem that we are trying to get around is using a nested for loop of uncertain depth, so we can't generate this table row by row. If we could do this there would be no need to reduce to a one dimensional space. However, we can create the same table by generating each column and put them together.
</p>

<div class="post-para">
$$
\begin{vmatrix}
1 & 1 & 1 \\
1 & 1 & 2 \\
1 & 2 & 1 \\
1 & 2 & 2 \\
2 & 1 & 1 \\
2 & 1 & 2 \\
2 & 2 & 1 \\
2 & 2 & 2
\end{vmatrix}
$$
</div>

<p class="post-para">
Notice that the the second and third variables have a repeating pattern. Identifying and exploiting this pattern is key to generating this one dimensional space. So I have created a variable <i>reptimes</i> which will idicate how many times I need to repeat a given pattern. The first variable does not have a repeating pattern so I make a special case and set <i>reptimes</i> to one. Now I need to find how many times I need to repeat a number in each pattern. So logically to get each unique data point I need to repeat a number once for each unique pairing of all the variables in the columns to the right of the one I am iterating though. So for this I create a new variable called <i>reduce</i>. In mathy words I am finding the size of the sub-space of the remaining variables. In less mathy words I am just recalculating <i>totalsize</i> for the remaining variables. The remaining few lines are just looping across each number and <i>reduce</i>.
</p>

<div class="post-para">
<div class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="lineno"> 1</span> <span class="c1">//generates each variable (each column)</span>
<span class="lineno"> 2</span> <span class="k">for</span> <span class="n">var</span><span class="o">=</span><span class="mi">0</span> <span class="k">to</span> <span class="nn">List</span><span class="p">.</span><span class="n">length</span><span class="o">(</span><span class="n">nbounds</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
<span class="lineno"> 3</span>     <span class="k">let</span> <span class="nv">mutable</span> <span class="n">rep</span> <span class="o">=</span> <span class="mi">1</span>
<span class="lineno"> 4</span>     <span class="k">let</span> <span class="nv">mutable</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="lineno"> 5</span>     <span class="k">if</span> <span class="n">var</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">rep</span> <span class="o">&lt;-</span> <span class="nn">List</span><span class="p">.</span><span class="n">length</span><span class="o">(</span><span class="n">nbounds</span><span class="o">.</span><span class="n">Item</span><span class="o">(</span><span class="n">var</span><span class="o">-</span><span class="mi">1</span><span class="o">))</span>
<span class="lineno"> 6</span>     <span class="c1">//loops through the number of pattern repetitions</span>
<span class="lineno"> 7</span>         <span class="k">for</span> <span class="n">reptimes</span><span class="o">=</span><span class="mi">1</span> <span class="k">to</span> <span class="n">rep</span> <span class="k">do</span>
<span class="lineno"> 8</span>             <span class="c1">//loops through the possible variable values</span>
<span class="lineno"> 9</span> 		    <span class="k">let</span> <span class="nv">reduce</span> <span class="o">=</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">fold</span><span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="n">f</span> <span class="o">-&gt;</span> <span class="n">acc</span> <span class="o">*</span> <span class="nn">List</span><span class="p">.</span><span class="n">length</span><span class="o">(</span><span class="n">f</span><span class="o">))</span> <span class="mi">1</span> <span class="o">(</span><span class="nn">Seq</span><span class="p">.</span><span class="n">take</span><span class="o">(</span><span class="n">var</span><span class="o">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">toSeq</span><span class="o">(</span><span class="n">nbounds</span><span class="o">)))</span>
<span class="lineno">10</span>             <span class="k">for</span> <span class="n">values</span><span class="o">=</span><span class="mi">0</span> <span class="k">to</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">length</span><span class="o">(</span><span class="n">nbounds</span><span class="o">.</span><span class="n">Item</span><span class="o">(</span><span class="n">var</span><span class="o">))</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="k">do</span>
<span class="lineno">11</span>                 <span class="c1">//loops through the value repetitions</span>
<span class="lineno">12</span>                 <span class="k">for</span> <span class="n">valuerep</span><span class="o">=</span><span class="mi">1</span> <span class="k">to</span> <span class="o">(</span><span class="n">totalsize</span> <span class="o">/</span> <span class="n">reduce</span><span class="o">)</span> <span class="k">do</span>
<span class="lineno">13</span>                     <span class="n">cords</span><span class="o">.[</span><span class="n">index</span><span class="o">].</span><span class="n">Add</span><span class="o">(</span><span class="n">this</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">Item</span><span class="o">(</span><span class="n">var</span><span class="o">).</span><span class="n">Lower</span><span class="o">+(</span><span class="n">this</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">Item</span><span class="o">(</span><span class="n">var</span><span class="o">).</span><span class="n">Step</span><span class="o">*(</span><span class="kt">float32</span><span class="o">(</span><span class="n">values</span><span class="o">))))</span>
<span class="lineno">14</span>                     <span class="n">index</span> <span class="o">&lt;-</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span></code></pre></div>
</div>

<p class="post-para">
That is all there is to it. Now I can simply use one loop to iterate across my newly created array <i>cords</i> and invoke my function at each point to evaluate. This evaluation then adds another column to <i>cords</i> such that each data point is represented as such:
</p>

<div class="post-para">
$$
[e_1,e_2,\ldots,e_n,F(e_1,e_2,\ldots,e_n)]
$$
</div>

<div class="post-para">
<div class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="lineno">1</span> <span class="c1">//Calculates the function output for each point.</span>
<span class="lineno">2</span> <span class="k">for</span> <span class="n">count</span><span class="o">=</span><span class="mi">0</span> <span class="k">to</span> <span class="o">(</span><span class="n">totalsize</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="k">do</span>
<span class="lineno">3</span>     <span class="c1">//Gathers the arguments for the point.</span>
<span class="lineno">4</span>     <span class="k">let</span> <span class="nv">args</span> <span class="o">=</span> <span class="n">cords</span><span class="o">.[</span><span class="n">count</span><span class="o">].</span><span class="n">ToArray</span><span class="bp">()</span>
<span class="lineno">5</span>     <span class="c1">//invokes the function with the given arguments and updates the coordinate grid.</span>
<span class="lineno">6</span>     <span class="n">cords</span><span class="o">.[</span><span class="n">count</span><span class="o">].</span><span class="n">Add</span><span class="o">(</span><span class="n">this</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">GetReturnFloat</span><span class="o">(</span><span class="n">args</span><span class="o">))</span>
<span class="lineno">7</span> <span class="n">cords</span></code></pre></div>
</div>
	
</div>
				
				<div style="margin-top:25px">
				
				<b>Like this post? <a href="/gists/N-Space-In-FSharp">Get the Gist</a></b>.
				  
				</div>

				
				 <div class="social-sharing">
	
	<div class="share-button text">
	Share
	</div>
	<div class="share-button twitter">
		<a href="https://twitter.com/home?status=/blog/N-Space-In-FSharp " target="_blank"><i class="fa fa-twitter social"></i></a>
	</div>
	<div class="share-button linkedin">
		<a href="http://www.linkedin.com/shareArticle?mini=true&url=/blog/N-Space-In-FSharp&title=N-Space in F#&summary=Creating N-Space grids for numerical evaluation of functions.&source=SawyerHopkins.com" target="_blank"><i class="fa fa-linkedin social"></i></a>
	</div>
	<div class="share-button gplus">
		<a href="https://plus.google.com/share?url=/blog/N-Space-In-FSharp" target="_blank"><i class="fa fa-google-plus social"></i></a>
	</div>
	
</div>
				  
				  
					<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'sawyerhopkins'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
     
				  
				  
				</div>
			</div>
			
		
		
	</body>
</html>